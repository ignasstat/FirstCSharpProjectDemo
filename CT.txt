# Set up your SQL connection details
$server = "PLLWINPPSQL001\MB21,1433"
$database = "DataBureauDataLoadAudit"
$connectionString = "Server=$server;Database=$database;Integrated Security=True;"

# Define your SQL query
$sqlQuery = @"
SELECT [FileFullPath]
      ,[FilePresent]
      ,[UpdatedDate]
FROM CT_TestIgnas
"@

# Create a SQL connection
$sqlConnection = New-Object System.Data.SqlClient.SqlConnection
$sqlConnection.ConnectionString = $connectionString
$sqlConnection.Open()

# Create a SQL command
$sqlCommand = $sqlConnection.CreateCommand()
$sqlCommand.CommandText = $sqlQuery

# Create a data adapter
$dataAdapter = New-Object System.Data.SqlClient.SqlDataAdapter $sqlCommand

# Create a dataset to store the results
$dataSet = New-Object System.Data.DataSet

# Fill the dataset with the results
$dataAdapter.Fill($dataSet) | Out-Null

# Loop through each row in the dataset
foreach ($row in $dataSet.Tables[0].Rows) {
    $filePath = $row["FileFullPath"]
    $fileExists = Test-Path $filePath

    # Update the FilePresent column based on file existence
    if ($fileExists) {
        $row["FilePresent"] = "Y"
    } else {
        $row["FilePresent"] = "N"
    }
}

# Update the changes back to the database
$dataAdapter.Update($dataSet)

# Close the SQL connection
$sqlConnection.Close()

# Display the updated data
$dataSet.Tables[0] | Format-Table -AutoSize


Exception calling "Fill" with "1" argument(s): "Invalid column name 'FilePresent'."
At line:30 char:1
+ $dataAdapter.Fill($dataSet) | Out-Null
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : SqlException
 
Exception calling "Update" with "1" argument(s): "Update unable to find TableMapping['Table'] or DataTable 'Table'."
At line:46 char:1
+ $dataAdapter.Update($dataSet)
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : InvalidOperationException
 
