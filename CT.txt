# SQL connection details
$server = "xxxx"
$database = "yyyyyyy"
$connectionString = "Server=$server;Database=$database;Integrated Security=True;"

$sqlQuery = @"
SELECT TOP (1000) [FilePresant]
      ,[UpdatedDate]
      ,[Folder]
      ,[FileName]
  FROM llll
  where UpdatedDate > '2023-01-01'
"@

$sqlConnection = New-Object System.Data.SqlClient.SqlConnection
$sqlConnection.ConnectionString = $connectionString
$sqlConnection.Open()

$sqlCommand = $sqlConnection.CreateCommand()
$sqlCommand.CommandText = $sqlQuery

$dataAdapter = New-Object System.Data.SqlClient.SqlDataAdapter $sqlCommand

$dataSet = New-Object System.Data.DataSet

$dataAdapter.Fill($dataSet) | Out-Null


# Loop through each row in the dataset and update values in a sql table
foreach ($row in $dataSet.Tables[0].Rows) {
    $FileName = $row["FileName"]
    $FolderName = $row["Folder"]
    $filePath = $row["Folder"]+$row["FileName"]
    $fileExists = Test-Path $filePath
  
    #$filePresantValue = 'Q'
    $filePresantValue = if ($fileExists) {'Y'} else {'N'}

    $updateTableCommand = "update CT_TestIgnas set FilePresant = '$filePresantValue' where FileName = '$FileName'"
    $updateCommand = $sqlConnection.CreateCommand()
    $updateCommand.CommandText = $updateTableCommand

    $updateCommand.ExecuteNonQuery() | Out-Null
}


# Close the SQL connection
$sqlConnection.Close()


