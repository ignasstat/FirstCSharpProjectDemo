WITH RunStatusForJobs AS (
    SELECT
        CT_JobID,
        RunStatus,
        highestrownum
    FROM (
        SELECT
            CT_JobID,
            RunStatus,
            ROW_NUMBER() OVER (PARTITION BY CT_JobID, RunStatus ORDER BY RunNo DESC) AS highestrownum
        FROM
            dbo.CT_JobRun
    ) RankedResults
    WHERE
        highestrownum = 1
)

SELECT
    YT.FileID,
    RS.CT_JobID,
    RS.highestrownum,
    RS.RunStatus
FROM
    dbo.CT_JobRun YT
LEFT JOIN
    RunStatusForJobs RS ON RS.CT_JobID = YT.CT_JobID AND RS.RunStatus = YT.RunStatus
ORDER BY
    RS.CT_JobID DESC;
