function Add-XMLNode($XML_Doc, $Parent, $Name, $Value) {
    $Node = $XML_Doc.CreateElement($Name)
    $Node.InnerText = $Value
    $Parent.AppendChild($Node) | Out-Null
}

function Create-TriggerFile {
    param(
        [string]$GUIDString,
        [ref]$ActionListNames,
        [string]$SaveLocation,
        [ref]$NodeStep,
        [string]$DestinationFolder,
        [string]$JobNumber,
        [string]$JobClient
    )

    # Create an XML document with a root element
    $xmlDoc = New-Object System.Xml.XmlDocument
    $root = $xmlDoc.CreateElement("EFT_Action")
    $xmlDoc.AppendChild($root) | Out-Null

    $NodeStep = 0
    # Add nodes with static and dynamic values
    Add-XMLNode $root "ProcessPriority" "50"
    Add-XMLNode $root "GUID" $GUIDString
    Add-XMLNode $root "StepSequence" ([string]$NodeStep.Value)
    Add-XMLNode $root "CreationDTS" (Get-Date -Format "yyyy-MM-dd HH:mm:ss")
    Add-XMLNode $root "RetriesRemaining" "2"
    Add-XMLNode $root "LastAttemptDTS" ""
    Add-XMLNode $root "LastResult" ""
    Add-XMLNode $root "FailureNotificationEmail" ""

    # Populate FailureNotificationEmail with more details
    $emailNode = $root.LastChild
    Add-XMLNode $emailNode "To" "DataOperationsEFT-CD@transunion.co.uk"
    Add-XMLNode $emailNode "CC" "DataBureau@transunion.co.uk"
    Add-XMLNode $emailNode "BCC" ""
    Add-XMLNode $emailNode "Subject" "DTP - $JobClient - $JobNumber - Completed Transfer trigger creation - Failed"
    Add-XMLNode $emailNode "Message" "The DTP has failed at creating completed file transfer trigger file in $DestinationFolder."

    # Add bespoke command to create a trigger file
    $triggerFilePath = Join-Path -Path $DestinationFolder -ChildPath "$JobNumber`_$JobClient.trg"
    Add-XMLNode $root "ActionType" "BespokeCommand"
    Add-XMLNode $root "SourceFile" "Trigger File | Out-File -FilePath '$triggerFilePath'"
    
    # Save the XML to a file
    $formattedNodeStep = "{0:D2}" -f $NodeStep.Value
    $xmlPath = Join-Path -Path $SaveLocation -ChildPath "50_$GUIDString_$formattedNodeStep.xml"
    $xmlDoc.Save($xmlPath)
    $ActionListNames.Value += "$xmlPath;"
    
    # Increment the step
    $NodeStep.Value += 1
}
# Usage
$ActionListNames = ""
$NodeStep = 0
Create-TriggerFile -GUIDString "0001" -ActionListNames ([ref]$ActionListNames) -SaveLocation "\\cig.local\data\AppData\SFTP\Data\Usr\DataBureau\Configuration\Scripts\Test\CallTrace Console\CTC124_125\Other" -NodeStep ([ref]$NodeStep) -DestinationFolder "\\cig.local\data\AppData\SFTP\Data\Usr\DataBureau\Configuration\Scripts\Test\CallTrace Console\CTC124_125\Other" -JobNumber "12345" -JobClient "ClientA"


Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
You cannot call a method on a null-valued expression.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
You cannot call a method on a null-valued expression.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
You cannot call a method on a null-valued expression.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
You cannot call a method on a null-valued expression.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
You cannot call a method on a null-valued expression.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
Method invocation failed because [System.Xml.XmlElement] does not contain a method named 'CreateElement'.
At line:2 char:5
+     $Node = $XML_Doc.CreateElement($Name)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (CreateElement:String) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
The property 'InnerText' cannot be found on this object. Verify that the property exists and can be set.
At line:3 char:5
+     $Node.InnerText = $Value
+     ~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound
 
Method invocation failed because [System.String] does not contain a method named 'AppendChild'.
At line:4 char:5
+     $Parent.AppendChild($Node) | Out-Null
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound
 
